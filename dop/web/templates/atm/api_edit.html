{% extends "shared/base.html" %}
{% load staticfiles %}
{% block head %}
    <link rel="stylesheet" href="{% static "css/main.css" %}?v={{ config.v }}">
    <link rel="stylesheet" href="{% static "css/apipage.css" %}?v={{ config.v }}">

    <script src="/static/js/lib/beautify.js"></script>
{% endblock %}
{% block container %}
    {% include "shared/headerBar.html" %}
    <div class="container">
        <div class="edit-top">
            <ol class="breadcrumb">
                <li>
                    {% if team == null %}
                    <a href="/projectlist">project</a>
                    {% else %}
                    <a href="/projectlist?team={{team}}">project</a>
                    {% endif %}
                </li>
                <li>
                    {% if project == null %}
                    <a href="/apilist">api</a>
                    {% else %}
                    <a href="/apilist?project={{project}}">api</a>
                    {% endif %}
                </li>
                <li class="active">十一月</li>
            </ol>
            <div class="edit-btns">
                <button ng-show="isEdit" type="button" ng-click="doEdit()" class="btn btn-primary">Edit</button>
                <button ng-hide="isEdit" ng-click="saveData()" type="button" class="btn btn-success">Save</button>
                <button ng-hide="isEdit" ng-click="cancelEdit()" type="button" class="btn btn-success">Cancel</button>
            </div>
        </div>
        <div class="edit-body">
            <div class="tab">
                <ul>
                    <li id="Base" class="active">Base</li>
                    <li id="Request">Request</li>
                    <li id="Response">Response</li>
                    <li id="ErrorCode">ErrorCode</li>
                </ul>
            </div>
            <div class="edit-content">
                <div id="Base_Main" class="content-list">
                    <div class="row">
                        <div class="col-xs-2">Project:</div>
                        <div class="col-xs-2">
                            <select ng-disabled='isProjectEdit' class="form-control" ng-options="project.project_name for project in projectList" ng-model="project_list_selected"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2">Name:</div>
                        <div class="col-xs-10">
                            <input type="text" ng-disabled='isEdit' ng-model="Base.name"
                                   placeholder="请输入接口名称..." class="form-control text-input">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2">Mock:</div>
                        <div class="col-xs-10">
                            <textarea ng-disabled='isEdit' ng-model="Base.mock" class="form-control textarea"
                                      cols="30" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2">Description:</div>
                        <div class="col-xs-10">
                            <textarea ng-disabled='isEdit' ng-model="Base.description"
                                      class="form-control textarea" cols="30" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2">Tags:</div>
                        <div class="col-xs-10 TagsTxt">
                            <span ng-dblclick="delTags($index)" ng-repeat="(key, value) in Base.tags" class="label label-warning" ng-class-even="'label-danger'">
                                @{value}@
                            </span>
                            {#<span class="label label-danger">危险标签</span>#}
                            <input ng-disabled='isEdit' placeholder="请创建提示标签" ng-keyup="enterTag($event)" type="text"><em class="tips">(双击删除标签)</em>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2">State:</div>
                        <div class="col-xs-10">
                            <label><input ng-click="setState(true)" ng- ng-checked="Base.state" ng-disabled='@{isEdit}@' type="radio" name="state"/>Enable</label>
                            <label><input ng-click="setState(false)" ng-checked="!Base.state" ng-disabled='@{isEdit}@' type="radio" name="state"/>Disable</label>
                        </div>
                    </div>
                </div>
                <div id="Request_Main" class="content-list" style="display: none;">
                    <div class="row">
                        <div class="col-xs-2">URL:</div>
                        <div class="col-xs-10">
                            <input ng-disabled='isEdit' type="text" ng-model="Request.url" placeholder="请输入路径..."
                                   class="form-control text-input">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-2">Method:</div>
                        <div class="col-xs-3">
                            <select style="width:90%;" ng-disabled='isEdit' ng-model="Request.method"
                                    class="form-control select-width">
                                <option>POST</option>
                                <option>GET</option>
                                <option>PUT</option>
                                <option>DELETE</option>
                            </select>
                        </div>
                        <div class="col-xs-2">ContentType:</div>
                        <div class="col-xs-3">
                            <select style="width:90%;" ng-disabled='isEdit' ng-model="Request.content_type"
                                    class="form-control select-width">
                                <option>1</option>
                                <option>application/json</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="req-content" id="Request-Headers">
                            <div class="api-top">
                                <div class="row">
                                    <div class="col-xs-1">Headers</div>
                                    <div class="col-xs-9"></div>
                                    <div class="col-xs-1"><a ng-disabled='isEdit' ng-click="toggleBulkEdit($event,'Rq_headers')" class="add-btn">BulkEdit</a></div>
                                    <div class="col-xs-1"><a ng-disabled='isEdit' ng-click="Add_headerDate()" class="add-btn">+Add</a></div>
                                </div>
                            </div>
                            <div class="api-body">
                                <table ng-hide="head_visible" class="table">
                                    <thead>
                                    <tr style="font-size:14px;">
                                        <th class="taTitle" style="min-width:120px;">名称</th>
                                        <th class="taTitle" style="width:60px;">类型</th>
                                        <th class="taTitle" style="width:60px;">是否<br>必填</th>
                                        <th class="taTitle" style="width:60px;">默认值</th>
                                        <th class="taTitle" style="width:60px;">示例</th>
                                        <th class="taTitle" style="width:60px;">描述</th>
                                        <th class="taTitle" style="width:110px;min-width:100px;">操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="RequestDate in Request.headers track by $index">
                                        <td class="tab-name">
                                            <input ng-disabled='isEdit' ng-init="RequestDate.field_name = ''"
                                                   ng-model="RequestDate.field_name" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-type">
                                            <select ng-disabled='isEdit' ng-model="RequestDate.field_type" class="form-control select-width">
                                                <option>number</option>
                                                <option>boolean</option>
                                                <option>string</option>
                                                <option>object</option>
                                            </select>
                                        </td>
                                        <td class="tab-must">
                                            <input ng-disabled='isEdit' ng-init="RequestDate.is_required = 'flase'"
                                                   ng-model="RequestDate.is_required" type="checkbox" name="is_requrie">
                                        </td>
                                        <td class="tab-def">
                                            <input ng-disabled='isEdit' ng-init="RequestDate.default = ''" ng-model="RequestDate.default"
                                                   type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-exmple">
                                            <input ng-disabled='isEdit' ng-init="RequestDate.example = ''" ng-model="RequestDate.example"
                                                   type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-dec">
                                            <input ng-disabled='isEdit' ng-change="a()" ng-model="RequestDate.description" type="text"
                                                   class="form-control"/>
                                        </td>
                                        <td class="tab-oper">
                                            <a ng-click="Del_headerDate($index)" href="javascript:;">移除</a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div ng-show="head_visible" class="headers-bulkEdit bulkEdit">
                                    <textarea ng-disabled='isEdit' ng-model="Request.headersBulk"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="req-content" id="Request-QueryString">
                            <div class="api-top">
                                <div class="row">
                                    <div class="col-xs-1">QueryString</div>
                                    <div class="col-xs-9"></div>
                                    <div class="col-xs-1"><a ng-click="toggleBulkEdit($event,'Rq_query_string')" class="add-btn">BulkEdit</a></div>
                                    <div class="col-xs-1"><a ng-click="Add_QueryStringDate()" class="add-btn">+Add</a>
                                    </div>
                                </div>
                            </div>
                            <div class="api-body">
                                <table ng-hide="query_string_visible" class="table">
                                    <thead>
                                    <tr style="font-size:14px;">
                                        <th class="taTitle" style="min-width:120px;">名称</th>
                                        <th class="taTitle" style="width:60px;">类型</th>
                                        <th class="taTitle" style="width:60px;">是否<br>必填</th>
                                        <th class="taTitle" style="width:60px;">默认值</th>
                                        <th class="taTitle" style="width:60px;">示例</th>
                                        <th class="taTitle" style="width:60px;">描述</th>
                                        <th class="taTitle" style="width:110px;min-width:100px;">操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="RequestDate in Request.query_string track by $index">
                                        <td class="tab-name">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.field_name" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-type">
                                            <select ng-disabled='isEdit' ng-model="RequestDate.field_type" class="form-control select-width">
                                                <option>number</option>
                                                <option>boolean</option>
                                                <option>string</option>
                                                <option>object</option>
                                            </select>
                                        </td>
                                        <td class="tab-must">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.is_required" type="checkbox" name="is_requrie">
                                        </td>
                                        <td class="tab-def">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.default" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-exmple">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.example" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-dec">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.description" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-oper">
                                            <a ng-click="Del_QueryStringDate($index)" href="javascript:;">移除</a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div ng-show="query_string_visible" class="query_string-bulkEdit bulkEdit">
                                    <textarea ng-disabled='isEdit' ng-model="Request.query_stringBulk"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="req-content" id="Request-Body">
                            <div class="api-top">
                                <div class="row">
                                    <div class="col-xs-1">Body</div>
                                    <div class="col-xs-6"></div>
                                    <div class="col-xs-3" style="text-align: right">
                                        <select ng-disabled='isEdit' style="float:right;height:30px;width:100px;padding:4px 3px; display: inherit"
                                                ng-model="Request.body.mode" class="form-control select-width">
                                            <option>urlencoded</option>
                                            <option>raw</option>
                                        </select>
                                        <span style="float: right;padding-right:10px;">mode</span>
                                    </div>
                                    <div class="col-xs-1"><a ng-click="toggleBulkEdit($event,'Rq_body')" class="add-btn">BulkEdit</a></div>
                                    <div class="col-xs-1"><a ng-click="Add_bodyDate()" class="add-btn">+Add</a></div>
                                </div>
                            </div>
                            <div class="api-body">
                                <table ng-hide="body_visible" class="table">
                                    <thead>
                                    <tr style="font-size:14px;">
                                        <th class="taTitle" style="min-width:120px;">名称</th>
                                        <th class="taTitle" style="width:60px;">类型</th>
                                        <th class="taTitle" style="width:60px;">是否<br>数组</th>
                                        <th class="taTitle" style="width:60px;">是否<br>必填</th>
                                        <th class="taTitle" style="width:60px;">默认值</th>
                                        <th class="taTitle" style="width:60px;">示例</th>
                                        <th class="taTitle" style="width:60px;">描述</th>
                                        <th class="taTitle" style="width:110px;min-width:100px;">操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="RequestDate in Request.body.data track by $index">
                                        <td class="tab-name">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.field_name" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-type">
                                            <select ng-disabled='isEdit' ng-model="RequestDate.field_type" class="form-control select-width">
                                                <option>number</option>
                                                <option>boolean</option>
                                                <option>string</option>
                                                <option>object</option>
                                            </select>
                                        </td>
                                        <td class="tab-arr">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.is_array" type="checkbox" name="is_requrie">
                                        </td>
                                        <td class="tab-must">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.is_required" type="checkbox" name="is_requrie">
                                        </td>
                                        <td class="tab-def">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.default" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-exmple">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.example" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-dec">
                                            <input ng-disabled='isEdit' ng-model="RequestDate.description" type="text" class="form-control"/>
                                        </td>
                                        <td class="tab-oper">
                                            <span ng-click="Add_bodyChildDate()"
                                                  ng-if="RequestDate.field_type == 'object' && Request.body.mode == 'raw'"><a
                                                    href="javascript:;">新增</a>|</span>
                                            <a ng-click="Del_bodyDate($index)" href="javascript:;">移除</a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div ng-show="body_visible" class="body-bulkEdit bulkEdit">
                                    <textarea ng-disabled='isEdit' ng-model="Request.BodyBulk"></textarea>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div id="Response_Main" class="content-list" style="display: none;">
                    <div class="req-content">
                        <div class="api-top">
                            <div class="row">
                                <div class="col-xs-1">Body</div>
                                <div class="col-xs-9"></div>
                                <div class="col-xs-1"><a ng-click="toggleBulkEdit($event,'Response')" class="add-btn">BulkEdit</a></div>
                                <div class="col-xs-1"><a ng-click="Add_ResponseDate()" class="add-btn">+Add</a></div>
                            </div>
                        </div>
                        <div class="api-body">
                            <table ng-hide="Response_visible" class="table">
                                <thead>
                                <tr>
                                    <th class="taTitle">名称</th>
                                    <th class="taTitle">类型</th>
                                    <th class="taTitle">是否数组</th>
                                    <th class="taTitle">是否必填</th>
                                    <th class="taTitle">默认值</th>
                                    <th class="taTitle">示例</th>
                                    <th class="taTitle">描述</th>
                                    <th class="taTitle" style="min-width: 120px">操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="RequestDate in Response.body track by $index">
                                    <td class="tab-name">
                                        <input ng-disabled='isEdit' ng-model="RequestDate.field_name" type="text" class="form-control"/>
                                    </td>
                                    <td class="tab-type">
                                        <select ng-disabled='isEdit' ng-model="RequestDate.field_type" class="form-control select-width">
                                            <option>number</option>
                                            <option>boolean</option>
                                            <option>string</option>
                                            <option>object</option>
                                        </select>
                                    </td>
                                    <td class="tab-arr">
                                        <input ng-disabled='isEdit' ng-model="RequestDate.is_array" type="checkbox" name="is_requrie">
                                    </td>
                                    <td class="tab-must">
                                        <input ng-disabled='isEdit' ng-model="RequestDate.is_required" type="checkbox" name="is_requrie">
                                    </td>
                                    <td class="tab-def">
                                        <input ng-disabled='isEdit' ng-model="RequestDate.default" type="text" class="form-control"/>
                                    </td>
                                    <td class="tab-exmple">
                                        <input ng-disabled='isEdit' ng-model="RequestDate.example" type="text" class="form-control"/>
                                    </td>
                                    <td class="tab-dec">
                                        <input ng-disabled='isEdit' ng-model="RequestDate.description" type="text" class="form-control"/>
                                    </td>
                                    <td class="tab-oper">
                                            <span ng-click="Add_ResponseChildDate()"
                                                  ng-if="RequestDate.field_type == 'object'"><a
                                                    href="javascript:;">新增</a>|</span>
                                        <a ng-click="Del_ResponseDate($index)" href="javascript:;">移除</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <div ng-show="Response_visible" class="Response-bulkEdit bulkEdit">
                                    <textarea ng-disabled='isEdit' ng-model="ResponseBulk"></textarea>
                                </div>
                        </div>
                    </div>
                </div>
                <div id="ErrorCodes_Main" class="content-list" style="display: none;">
                    <div class="req-content">
                        <div class="api-top">
                            <div class="row">
                                <div class="col-xs-1">ErrorCodes</div>
                                <div class="col-xs-9"></div>
                                <div class="col-xs-1"><a ng-click="toggleBulkEdit($event,'ErrorCodes')" class="add-btn">BulkEdit</a></div>
                                <div class="col-xs-1"><a ng-click="Add_ErrorCodeDate()" class="add-btn">+Add</a></div>
                            </div>
                        </div>
                        <div class="api-body">
                            <table ng-hide="ErrorCodes_visible" class="table">
                                <thead>
                                <tr>
                                    <th class="taTitle">错误码</th>
                                    <th class="taTitle">显示信息</th>
                                    <th class="taTitle">描述</th>
                                    <th class="taTitle">操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="RequestDate in errorCodes track by $index">
                                    <td>
                                        <input ng-disabled='isEdit' ng-model="RequestDate.error_code" type="text" class="form-control"/>
                                    </td>
                                    <td>
                                        <input ng-disabled='isEdit' ng-model="RequestDate.display_message" type="text" class="form-control"/>
                                    </td>
                                    <td>
                                        <input ng-disabled='isEdit' ng-model="RequestDate.description" type="text" class="form-control"/>
                                    </td>
                                    <td>
                                        <a ng-click="Del_ErrorCodeDate($index)" href="javascript:;">移除</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <div ng-show="ErrorCodes_visible" class="ErrorCodes-bulkEdit bulkEdit">
                                    <textarea ng-disabled='isEdit' ng-model="ErrorCodesBulk"></textarea>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        $(function () {
            $(".tab ul li").click(function () {
                var _this = $(this);
                var index = _this.index();
                _this.addClass("active").siblings().removeClass("active");
                $(".edit-content .content-list").hide();
                $(".edit-content .content-list").eq(index).show()

            });

        });
        require(['{% static "js/config.js" %}?v={{config.v}}'], function () {
            require(['controller/atm/api_edit']);
        });
    </script>
{% endblock %}
